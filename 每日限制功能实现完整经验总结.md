# æ¸¸æˆæ¯æ—¥é™åˆ¶åŠŸèƒ½å®ç°å®Œæ•´ç»éªŒæ€»ç»“

## ğŸ“‹ é¡¹ç›®èƒŒæ™¯

ä¸ºå››æ¬¾åŸºäºGitHub Pagesçš„HTML5æ¸¸æˆå®ç°æ¯æ—¥é™åˆ¶åŠŸèƒ½ï¼šæ¯ä¸ªç”¨æˆ·æ¯å¤©åªèƒ½ç©ä¸€æ¬¡æ¸¸æˆï¼ˆä»»æ„ä¸€æ¬¾ï¼‰ï¼Œä½¿ç”¨ä¸­å›½æ—¶åŒºï¼Œæ˜å¤©00:00åå¯ä»¥é‡æ–°å¼€å§‹ã€‚

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

- **æ¯æ—¥é™åˆ¶**ï¼šæ¯ä¸ªç”¨æˆ·æ¯å¤©åªèƒ½ç©ä¸€æ¬¡æ¸¸æˆ
- **è·¨æ¸¸æˆå…±äº«**ï¼šå››æ¬¾æ¸¸æˆå…±äº«åŒä¸€ä¸ªæ¯æ—¥é™åˆ¶
- **ä¸­å›½æ—¶åŒº**ï¼šä½¿ç”¨Asia/Shanghaiæ—¶åŒºè®¡ç®—æ—¥æœŸ
- **æœ€å°æ”¹åŠ¨**ï¼šåœ¨ç°æœ‰æ¸¸æˆåŸºç¡€ä¸Šæœ€å°åŒ–ä¿®æ”¹
- **æ— æœåŠ¡å™¨**ï¼šä»…ä½¿ç”¨GitHub Pagesï¼Œä¸ä½¿ç”¨åç«¯æœåŠ¡

## ğŸš« å¤±è´¥çš„æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šGitHub Gist API
**é—®é¢˜**ï¼šGitHub Gist APIéœ€è¦èº«ä»½éªŒè¯æ‰èƒ½æ›´æ–°æ•°æ®
```javascript
// å¤±è´¥çš„ä»£ç ç¤ºä¾‹
const response = await fetch(gistUrl, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
});
// è¿”å›401 Unauthorizedé”™è¯¯
```

**å¤±è´¥åŸå› **ï¼š
- éœ€è¦Personal Access Token
- å…¬å¼€Gistæ— æ³•é€šè¿‡APIæ›´æ–°
- èº«ä»½éªŒè¯å¤æ‚ï¼Œä¸é€‚åˆå‰ç«¯ç›´æ¥è°ƒç”¨

### æ–¹æ¡ˆ2ï¼šGitHub APIç›´æ¥æ›´æ–°æ–‡ä»¶
**é—®é¢˜**ï¼šåŒæ ·éœ€è¦èº«ä»½éªŒè¯ï¼Œä¸”éœ€è¦æ–‡ä»¶çš„SHAå€¼
```javascript
// å¤±è´¥çš„ä»£ç ç¤ºä¾‹
const response = await fetch(`https://api.github.com/repos/owner/repo/contents/file.json`, {
    method: 'PUT',
    headers: { 'Authorization': 'token YOUR_TOKEN' },
    body: JSON.stringify({
        message: 'Update data',
        content: btoa(JSON.stringify(data)),
        sha: fileSha // éœ€è¦å…ˆè·å–æ–‡ä»¶SHA
    })
});
```

## âœ… æˆåŠŸçš„æ–¹æ¡ˆ

### æœ€ç»ˆæ–¹æ¡ˆï¼šlocalStorage + URLå‚æ•°åŒæ­¥

**æ ¸å¿ƒæ€è·¯**ï¼š
1. ä½¿ç”¨localStorageå­˜å‚¨ç”¨æˆ·æ¸¸æˆè®°å½•
2. é€šè¿‡URLå‚æ•°å®ç°è·¨æ¸¸æˆåŒæ­¥
3. åŸºäºä¸­å›½æ—¶åŒºåˆ¤æ–­æ¯æ—¥é™åˆ¶

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ•°æ®ç®¡ç†ç±»è®¾è®¡

```javascript
class DailyLimitManager {
    constructor() {
        this.gameId = 'game3'; // å½“å‰æ¸¸æˆID
        this.storageKey = 'daily_limit_data';
    }

    // è·å–ä¸­å›½æ—¶åŒºçš„ä»Šå¤©æ—¥æœŸ
    getChinaToday() {
        const now = new Date();
        const chinaTime = new Intl.DateTimeFormat('en-CA', {
            timeZone: 'Asia/Shanghai',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
        }).format(now);
        return chinaTime; // æ ¼å¼: YYYY-MM-DD
    }

    // è·å–ç”¨æˆ·å”¯ä¸€æ ‡è¯†
    getUserKey(employeeId, employeeName) {
        return `${employeeId}_${employeeName}`;
    }

    // ä»localStorageè·å–æ•°æ®
    getData() {
        try {
            const data = localStorage.getItem(this.storageKey);
            return data ? JSON.parse(data) : { users: {} };
        } catch (error) {
            console.error('è·å–æœ¬åœ°æ•°æ®å¤±è´¥:', error);
            return { users: {} };
        }
    }

    // ä¿å­˜æ•°æ®åˆ°localStorage
    saveData(data) {
        try {
            localStorage.setItem(this.storageKey, JSON.stringify(data));
            return true;
        } catch (error) {
            console.error('ä¿å­˜æœ¬åœ°æ•°æ®å¤±è´¥:', error);
            return false;
        }
    }
}
```

### 2. æ¯æ—¥é™åˆ¶æ£€æŸ¥

```javascript
// æ£€æŸ¥ç”¨æˆ·ä»Šæ—¥æ˜¯å¦å·²ç©æ¸¸æˆ
checkDailyLimit(employeeId, employeeName) {
    const userKey = this.getUserKey(employeeId, employeeName);
    const today = this.getChinaToday();
    
    try {
        const data = this.getData();
        const user = data.users[userKey];
        
        if (user && user.lastPlayDate === today) {
            return {
                canPlay: false,
                reason: 'ä»Šæ—¥å·²ç©è¿‡æ¸¸æˆï¼Œè¯·æ˜å¤©00:00åå†è¯•ï¼',
                playedGames: user.games || {}
            };
        }
        
        return { canPlay: true };
    } catch (error) {
        console.error('æ£€æŸ¥æ¯æ—¥é™åˆ¶å¤±è´¥:', error);
        // å‡ºé”™æ—¶å…è®¸æ¸¸æˆï¼Œé¿å…å½±å“ç”¨æˆ·ä½“éªŒ
        return { canPlay: true };
    }
}
```

### 3. æ¸¸æˆè®°å½•ä¿å­˜

```javascript
// è®°å½•ç”¨æˆ·ä»Šæ—¥æ¸¸æˆ
recordGamePlay(employeeId, employeeName) {
    const userKey = this.getUserKey(employeeId, employeeName);
    const today = this.getChinaToday();
    
    try {
        const data = this.getData();
        
        if (!data.users[userKey]) {
            data.users[userKey] = {
                lastPlayDate: today,
                games: {}
            };
        }
        
        // æ›´æ–°æœ€åæ¸¸æˆæ—¥æœŸå’Œå½“å‰æ¸¸æˆè®°å½•
        data.users[userKey].lastPlayDate = today;
        data.users[userKey].games[this.gameId] = true;
        
        // ä¿å­˜æ•°æ®
        const success = this.saveData(data);
        
        // åŒæ—¶é€šè¿‡URLå‚æ•°é€šçŸ¥å…¶ä»–æ¸¸æˆ
        this.notifyOtherGames(employeeId, employeeName, today);
        
        return success;
    } catch (error) {
        console.error('è®°å½•æ¸¸æˆå¤±è´¥:', error);
        return false;
    }
}
```

### 4. è·¨æ¸¸æˆåŒæ­¥æœºåˆ¶

```javascript
// é€šè¿‡URLå‚æ•°é€šçŸ¥å…¶ä»–æ¸¸æˆï¼ˆè·¨æ¸¸æˆé™åˆ¶ï¼‰
notifyOtherGames(employeeId, employeeName, today) {
    // åˆ›å»ºä¸€ä¸ªéšè—çš„iframeæ¥é€šçŸ¥å…¶ä»–æ¸¸æˆ
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.src = `https://hmh38324.github.io/game1/?notify=played&user=${encodeURIComponent(employeeId + '_' + employeeName)}&date=${today}&game=${this.gameId}`;
    document.body.appendChild(iframe);
    
    // æ¸…ç†iframe
    setTimeout(() => {
        document.body.removeChild(iframe);
    }, 1000);
}

// åˆå§‹åŒ–æ—¶æ£€æŸ¥URLå‚æ•°
init() {
    const urlParams = new URLSearchParams(window.location.search);
    const notify = urlParams.get('notify');
    const user = urlParams.get('user');
    const date = urlParams.get('date');
    const game = urlParams.get('game');
    
    if (notify === 'played' && user && date && game) {
        // æ›´æ–°æœ¬åœ°æ•°æ®
        const data = this.getData();
        if (!data.users[user]) {
            data.users[user] = {
                lastPlayDate: date,
                games: {}
            };
        }
        data.users[user].lastPlayDate = date;
        data.users[user].games[game] = true;
        this.saveData(data);
        
        // æ¸…ç†URLå‚æ•°
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
    }
}
```

## ğŸ® æ¸¸æˆé›†æˆ

### 1. æ¸¸æˆç±»ä¿®æ”¹

```javascript
class ColorTrapGame {
    constructor() {
        // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
        this.dailyLimitManager = new DailyLimitManager();
        this.loadPeopleData();
    }

    init() {
        this.createQuestionInterface();
        this.updateStartButton();
        this.updateUserInfo();
        // åˆå§‹åŒ–æ¯æ—¥é™åˆ¶ç®¡ç†å™¨
        this.dailyLimitManager.init();
    }

    startGame() {
        // æ£€æŸ¥æ¯æ—¥é™åˆ¶
        if (this.isLoggedIn && this.currentUser) {
            const limitCheck = this.dailyLimitManager.checkDailyLimit(
                this.currentUser.å·¥å·, 
                this.currentUser.å§“å
            );
            
            if (!limitCheck.canPlay) {
                alert(limitCheck.reason);
                return;
            }
        }
        
        // ... æ¸¸æˆå¼€å§‹é€»è¾‘
    }

    checkWin() {
        if (this.correctAnswers >= 6) {
            this.isGameWon = true;
            this.stopTimer();
            
            // è®°å½•ç”¨æˆ·ä»Šæ—¥å·²ç©æ¸¸æˆ
            if (this.isLoggedIn && this.currentUser) {
                this.dailyLimitManager.recordGamePlay(
                    this.currentUser.å·¥å·, 
                    this.currentUser.å§“å
                );
            }
            
            // ... å…¶ä»–èƒœåˆ©é€»è¾‘
        }
    }
}
```

### 2. æ•°æ®ç»“æ„

```json
{
  "users": {
    "å·¥å·_å§“å": {
      "lastPlayDate": "2025-01-21",
      "games": {
        "game1": true,
        "game2": true,
        "game3": true,
        "game4": true
      }
    }
  }
}
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. åŠŸèƒ½æµ‹è¯•é¡µé¢

åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•é¡µé¢ `test_daily_limit.html`ï¼ŒåŒ…å«ï¼š
- æ—¶åŒºæµ‹è¯•
- ç”¨æˆ·æ ‡è¯†æµ‹è¯•
- é™åˆ¶æ£€æŸ¥æµ‹è¯•
- æ•°æ®è·å–æµ‹è¯•
- æ¸¸æˆè®°å½•æµ‹è¯•
- å®Œæ•´æµç¨‹æµ‹è¯•

### 2. æµ‹è¯•æ­¥éª¤

1. **åŸºç¡€åŠŸèƒ½æµ‹è¯•**ï¼š
   ```javascript
   // æµ‹è¯•æ—¶åŒºè®¡ç®—
   const today = manager.getChinaToday();
   console.log('ä¸­å›½æ—¶åŒºä»Šå¤©æ—¥æœŸ:', today);
   
   // æµ‹è¯•ç”¨æˆ·æ ‡è¯†
   const userKey = manager.getUserKey('12345', 'æµ‹è¯•ç”¨æˆ·');
   console.log('ç”¨æˆ·æ ‡è¯†:', userKey);
   ```

2. **é™åˆ¶åŠŸèƒ½æµ‹è¯•**ï¼š
   ```javascript
   // ç¬¬ä¸€æ¬¡æ£€æŸ¥ - åº”è¯¥å…è®¸
   const check1 = manager.checkDailyLimit('12345', 'æµ‹è¯•ç”¨æˆ·');
   console.log('ç¬¬ä¸€æ¬¡æ£€æŸ¥:', check1.canPlay); // true
   
   // è®°å½•æ¸¸æˆ
   manager.recordGamePlay('12345', 'æµ‹è¯•ç”¨æˆ·');
   
   // ç¬¬äºŒæ¬¡æ£€æŸ¥ - åº”è¯¥é™åˆ¶
   const check2 = manager.checkDailyLimit('12345', 'æµ‹è¯•ç”¨æˆ·');
   console.log('ç¬¬äºŒæ¬¡æ£€æŸ¥:', check2.canPlay); // false
   ```

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| GitHub Gist API | æ•°æ®é›†ä¸­ç®¡ç† | éœ€è¦èº«ä»½éªŒè¯ | æœ‰åç«¯æ”¯æŒçš„é¡¹ç›® |
| GitHub API | æ•°æ®é›†ä¸­ç®¡ç† | éœ€è¦èº«ä»½éªŒè¯å’ŒSHA | æœ‰åç«¯æ”¯æŒçš„é¡¹ç›® |
| localStorage | ç®€å•å¯é ï¼Œæ— APIä¾èµ– | æ•°æ®åˆ†æ•£ï¼Œè·¨è®¾å¤‡ä¸åŒæ­¥ | å‰ç«¯é¡¹ç›®ï¼Œå•è®¾å¤‡ä½¿ç”¨ |
| URLå‚æ•°åŒæ­¥ | è·¨æ¸¸æˆåŒæ­¥ | éœ€è¦ç”¨æˆ·è®¿é—®å…¶ä»–æ¸¸æˆ | å¤šæ¸¸æˆé¡¹ç›® |

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ—¶åŒºå¤„ç†
```javascript
// æ¨èï¼šä½¿ç”¨Intl.DateTimeFormat
const chinaTime = new Intl.DateTimeFormat('en-CA', {
    timeZone: 'Asia/Shanghai',
    year: 'numeric',
    month: '2-digit',
    day: '2-digit'
}).format(now);

// é¿å…ï¼šæ‰‹åŠ¨è®¡ç®—æ—¶åŒºåç§»
// const chinaTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
```

### 2. é”™è¯¯å¤„ç†
```javascript
// æ¨èï¼šå‡ºé”™æ—¶å…è®¸æ¸¸æˆï¼Œé¿å…å½±å“ç”¨æˆ·ä½“éªŒ
try {
    const limitCheck = this.checkDailyLimit(employeeId, employeeName);
    return limitCheck;
} catch (error) {
    console.error('æ£€æŸ¥æ¯æ—¥é™åˆ¶å¤±è´¥:', error);
    return { canPlay: true }; // å‡ºé”™æ—¶å…è®¸æ¸¸æˆ
}
```

### 3. æ•°æ®éªŒè¯
```javascript
// æ¨èï¼šéªŒè¯æ•°æ®å®Œæ•´æ€§
getData() {
    try {
        const data = localStorage.getItem(this.storageKey);
        const parsed = data ? JSON.parse(data) : { users: {} };
        
        // éªŒè¯æ•°æ®ç»“æ„
        if (!parsed.users || typeof parsed.users !== 'object') {
            return { users: {} };
        }
        
        return parsed;
    } catch (error) {
        console.error('è·å–æœ¬åœ°æ•°æ®å¤±è´¥:', error);
        return { users: {} };
    }
}
```

## ğŸš€ éƒ¨ç½²è¯´æ˜

### 1. å•æ¸¸æˆéƒ¨ç½²
1. å¤åˆ¶ `DailyLimitManager` ç±»åˆ°æ¸¸æˆä»£ç ä¸­
2. ä¿®æ”¹ `gameId` ä¸ºå¯¹åº”çš„æ¸¸æˆID
3. åœ¨æ¸¸æˆå¼€å§‹å’Œç»“æŸæ—¶è°ƒç”¨ç›¸åº”æ–¹æ³•
4. éƒ¨ç½²åˆ°GitHub Pages

### 2. å¤šæ¸¸æˆéƒ¨ç½²
1. ä¸ºæ¯æ¬¾æ¸¸æˆé…ç½®ä¸åŒçš„ `gameId`
2. ä½¿ç”¨ç›¸åŒçš„ `storageKey`
3. ç¡®ä¿è·¨æ¸¸æˆåŒæ­¥çš„URLæ­£ç¡®
4. åˆ†åˆ«éƒ¨ç½²åˆ°ä¸åŒçš„GitHub Pages

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®æŒä¹…æ€§
- localStorageæ•°æ®åœ¨ç”¨æˆ·æ¸…é™¤æµè§ˆå™¨æ•°æ®æ—¶ä¼šä¸¢å¤±
- å»ºè®®æ·»åŠ æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
- è€ƒè™‘ä½¿ç”¨IndexedDBå­˜å‚¨å¤§é‡æ•°æ®

### 2. è·¨è®¾å¤‡åŒæ­¥
- localStorageæ— æ³•è·¨è®¾å¤‡åŒæ­¥
- å¦‚éœ€è·¨è®¾å¤‡åŒæ­¥ï¼Œéœ€è¦æœåŠ¡å™¨æ”¯æŒ
- å½“å‰æ–¹æ¡ˆé€‚åˆå•è®¾å¤‡ä½¿ç”¨åœºæ™¯

### 3. å®‰å…¨æ€§
- localStorageæ•°æ®å¯ä»¥è¢«ç”¨æˆ·ä¿®æ”¹
- ä¸é€‚åˆå­˜å‚¨æ•æ„Ÿä¿¡æ¯
- ä»…ç”¨äºæ¸¸æˆé™åˆ¶åŠŸèƒ½

### 4. æ€§èƒ½è€ƒè™‘
- localStorageè¯»å†™æ€§èƒ½è¾ƒå¥½
- é¿å…é¢‘ç¹çš„å¤§æ•°æ®æ“ä½œ
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

## ğŸ”„ æ‰©å±•å¯èƒ½

### 1. æ•°æ®åŒæ­¥
- é›†æˆäº‘å­˜å‚¨æœåŠ¡ï¼ˆå¦‚Firebaseï¼‰
- ä½¿ç”¨WebSocketå®æ—¶åŒæ­¥
- æ·»åŠ æ•°æ®å†²çªè§£å†³æœºåˆ¶

### 2. é™åˆ¶ç±»å‹
- æ”¯æŒå°æ—¶é™åˆ¶
- æ”¯æŒå‘¨é™åˆ¶
- æ”¯æŒè‡ªå®šä¹‰é™åˆ¶è§„åˆ™

### 3. ç»Ÿè®¡åŠŸèƒ½
- è®°å½•ç”¨æˆ·æ¸¸æˆé¢‘ç‡
- æ·»åŠ æ¸¸æˆæ—¶é•¿ç»Ÿè®¡
- ç”Ÿæˆç”¨æˆ·è¡Œä¸ºæŠ¥å‘Š

## ğŸ“ æ€»ç»“

è¿™ä¸ªæ¯æ—¥é™åˆ¶åŠŸèƒ½å®ç°æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **ç®€å•å¯é **ï¼šåŸºäºlocalStorageï¼Œæ— APIä¾èµ–
2. **å³æ—¶ç”Ÿæ•ˆ**ï¼šè®°å½•åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€ç­‰å¾…
3. **è·¨æ¸¸æˆåŒæ­¥**ï¼šé€šè¿‡URLå‚æ•°å®ç°å¤šæ¸¸æˆé™åˆ¶
4. **æ—¶åŒºå‡†ç¡®**ï¼šä½¿ç”¨æ ‡å‡†APIå¤„ç†ä¸­å›½æ—¶åŒº
5. **é”™è¯¯å®¹é”™**ï¼šå‡ºé”™æ—¶å…è®¸æ¸¸æˆï¼Œä¿è¯ç”¨æˆ·ä½“éªŒ
6. **æ˜“äºéƒ¨ç½²**ï¼šä»…éœ€å‰ç«¯ä»£ç ï¼Œé€‚åˆGitHub Pages

è¯¥æ–¹æ¡ˆç‰¹åˆ«é€‚åˆï¼š
- åŸºäºGitHub Pagesçš„é™æ€ç½‘ç«™
- ä¸éœ€è¦å¤æ‚åç«¯æ”¯æŒçš„é¡¹ç›®
- å•è®¾å¤‡ä½¿ç”¨çš„æ¸¸æˆåœºæ™¯
- å¿«é€ŸåŸå‹å’ŒMVPå¼€å‘

é€šè¿‡è¿™ä¸ªæ–¹æ¡ˆï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†å››æ¬¾æ¸¸æˆçš„æ¯æ—¥é™åˆ¶åŠŸèƒ½ï¼Œç”¨æˆ·æ¯å¤©åªèƒ½ç©ä¸€æ¬¡æ¸¸æˆï¼Œæ»¡è¶³äº†æ‰€æœ‰æ ¸å¿ƒéœ€æ±‚ã€‚
